(()=>{"use strict";var e={d:(t,o)=>{for(var n in o)e.o(o,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:o[n]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};e.d({},{x:()=>J});var t={baseUrl:"https://nomoreparties.co/v1/plus-cohort-5",headers:{authorization:"05f82657-01f1-41e6-be67-f457afff82d0","Content-Type":"application/json; charset=UTF-8"}};function o(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}var n=".popup__loading",c=".popup__save-text",r=document.querySelector(".profile__edit"),a=document.querySelector(".profile__add-button"),l=(document.querySelector(".popup__close_profile"),document.querySelector(".popup_profile")),u=document.querySelector(".popup_add-photo"),i=document.querySelector(".popup_photo"),s=document.querySelector(".profile__title"),d=document.querySelector(".profile__subtitle"),p=document.querySelector(".popup__form_profile"),_=p.querySelector("#name"),f=p.querySelector("#hobbie"),m=p.querySelector(c),v=p.querySelector(n),h=document.querySelectorAll(".popup"),y=document.querySelector(".popup_change-avatar"),S=document.querySelector(".popup__form_avatar"),b=document.querySelector("#avatar"),q=S.querySelector(n),L=S.querySelector(c);function g(e){e.classList.add("popup_opened"),document.addEventListener("keydown",k)}function E(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",k)}function k(e){"Escape"===e.key&&E(document.querySelector(".popup_opened"))}function x(e,t,o,n){o?(e.textContent=n,t.classList.add("popup__loading_active")):(e.textContent=n,t.classList.remove("popup__loading_active"))}h.forEach((function(e){e.addEventListener("click",(function(t){t.target.classList.contains("popup_opened")&&E(e),t.target.classList.contains("popup__close")&&E(e)}))}));var C=document.querySelector(".popup__image"),U=document.querySelector(".popup__image-title"),T=document.querySelector(".elements"),A=document.querySelector(".form__photo"),O=A.querySelector("#place"),P=A.querySelector("#link"),j=document.querySelector(".popup__save_photo"),D=(document.querySelector(".popup_remove-photo"),document.querySelector(".popup__save_remove-photo"),A.querySelector(".popup__save-text")),w=A.querySelector(".popup__loading");function N(e,n){T.prepend(function(e,n){var c=document.querySelector(".photo__template").content.querySelector(".element").cloneNode(!0);c.querySelector(".element__title").textContent=e.name;var r,a=c.querySelector(".element__img");a.src=e.link,a.alt=e.name,n===e.owner._id&&(r=c,r.insertAdjacentHTML("beforeend",'<button class="element__delete" type="button"></button>'),r.querySelector(".element__delete")).addEventListener("click",(function(){(function(e){return fetch("".concat(t.baseUrl,"/cards/").concat(e),{method:"DELETE",headers:t.headers}).then(o)})(e._id).then((function(e){console.log(e),c.remove()})).catch((function(e){console.log(e)}))}));var l=c.querySelector(".element__numbers-of-likes"),u=c.querySelector(".element__like");return H(l,e.likes,n,u),u.addEventListener("click",(function(n){!function(e,n,c){e.classList.contains("element__like_active")?function(e){return fetch("".concat(t.baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:t.headers}).then(o)}(c).then((function(t){e.classList.remove("element__like_active"),console.log(t),H(n,t.likes)})).catch((function(e){console.log(e)})):function(e){return fetch("".concat(t.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:t.headers}).then(o)}(c).then((function(t){e.classList.add("element__like_active"),console.log(t),H(n,t.likes)})).catch((function(e){console.log(e)}))}(u,l,e._id)})),a.addEventListener("click",(function(){g(i),C.src=e.link,C.alt=e.name,U.textContent=e.name})),c}(e,n))}function H(e,t,o,n){t.length>0?(e.textContent=t.length,t.forEach((function(e){e._id===o&&n.classList.add("element__like_active")}))):e.textContent=""}var J,B=document.querySelector(".profile__img");fetch("".concat(t.baseUrl,"/users/me"),{headers:t.headers}).then(o).then((function(e){return console.log(e),_.value=e.name,f.value=e.about,B.src=e.avatar,s.textContent=e.name,d.textContent=e.about,J=e._id,fetch("".concat(t.baseUrl,"/cards"),{headers:t.headers}).then(o).then((function(e){console.log(e),e.forEach((function(e){N(e,J)}))})),J})).catch((function(e){console.log(e)}));var M,z,F,G,I=document.querySelector(".profile__img-overlay");r.addEventListener("click",(function(){return g(l)})),a.addEventListener("click",(function(){return g(u)})),I.addEventListener("click",(function(){return g(y)})),p.addEventListener("submit",(function(e){var n,c;e.preventDefault(),x(m,v,!0,"Сохранение"),(n=_.value,c=f.value,fetch("".concat(t.baseUrl,"/users/me"),{method:"PATCH",headers:t.headers,body:JSON.stringify({name:n,about:c})}).then(o)).then((function(e){console.log(e),s.textContent=e.name,d.textContent=e.about,E(l)})).catch((function(e){console.log(e)})).finally((function(){x(m,v,!1,"Сохранить")}))})),A.addEventListener("submit",(function(e){var n,c;e.preventDefault(),x(D,w,!0,"Создание"),(n=O.value,c=P.value,fetch("".concat(t.baseUrl,"/cards"),{method:"POST",headers:t.headers,body:JSON.stringify({name:n,link:c})}).then(o)).then((function(e){N(e,J),E(u),A.reset(),j.disabled=1,j.classList.add("popup__save_disabled")})).catch((function(e){console.log(e)})).finally((function(){x(D,w,!1,"Создать")}))})),S.addEventListener("submit",(function(){x(L,q,!0,"Сохранение"),function(e){return fetch("".concat(t.baseUrl,"/users/me/avatar "),{method:"PATCH",headers:t.headers,body:JSON.stringify({avatar:e})}).then(o)}(b.value).then((function(e){B.src=e.avatar,E(y)})).catch((function(e){console.log(e)})).finally((function(){x(L,q,!1,"Сохранить")}))})),z=(M={formSelector:".popup__form",inputSelector:".popup__text-input",submitButtonSelector:".popup__save"}).formSelector,F=M.inputSelector,G=M.submitButtonSelector,Array.from(document.querySelectorAll(z)).forEach((function(e){e.addEventListener("submit",(function(e){e.preventDefault()}));var t=Array.from(e.querySelectorAll(F)),o=e.querySelector(G);t.forEach((function(e){e.addEventListener("input",(function(){var n;(n=e).validity.valid?function(e){e.classList.remove("".concat(e.classList[0],"_type_error"));var t=e.nextElementSibling;t.textContent="",t.classList.remove("".concat(t.classList[0],"_active"))}(n):function(e,t){e.classList.add("".concat(e.classList[0],"_type_error"));var o=e.nextElementSibling;o.textContent=t,o.classList.add("".concat(o.classList[0],"_active"))}(n,n.validationMessage),function(e,t){e.every((function(e){return e.validity.valid}))?(t.classList.remove("".concat(t.classList[0],"_disabled")),t.disabled=0):(t.classList.add("".concat(t.classList[0],"_disabled")),t.disabled=1)}(t,o)}))}))}))})();